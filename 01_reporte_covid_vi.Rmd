---
title: "Analysis of COVID-19 Vulnerability and Mortality"
author: "Amin Valencia revised by Dr. Gener Aviles"
date: "12/24/2021"
output:
  html_document:
    df_print: paged
---
  
##### Aim
In this area we aim to collaborate using R in statistical analysis. This project in particular intends to compare the incidence of type two diabetes in each category of COVID vulnerability risk and explore a relationship between mortality.

To compare incidence of type two diabetes in each category of COVID vulnerability risk and explore a relationship between mortality.

##### Data
 Mexican Directory of Epidemiology:
 Open access Data
 Covid-19 Database
 https://www.gob.mx/salud/documentos/datos-abiertos-152127
 
 Autonomous University of Mexico(UNAM)
 National Institute of Geography and Statistics(INEGI)
 Vulnerability Index regarding Covid-19
 : Open access Data
 https://www.gits.igg.unam.mx/iCOVID-19/home
 
###### Installing and Loading Packages
```{r Installing and Loading Packages, echo=TRUE, message=FALSE, warning=FALSE}
# install.packages("data.table")
# install.packages("tidyverse")
# install.packages("readxl")
# install.packages("_Bootswatch Themes_")
require("data.table")
require("tidyverse")
library("readxl")
require("_Bootswatch Themes_")
```
### 1. Loading Database
##### 1a. Loading
```{r Loading Raw Database}
raw_database <-
  fread("~/Documents/Investigación/Projects/vulnerability_index_covid/01_analysis/211223COVID19MEXICO.csv")
```
##### 1b. Sampling Raw Dataset
A subset of N = 10,000 was created. Rows with unavailable data regarding state or municipality residency were removed.

_codes were commented because some filtered criteria did not exist in dataset._
```{r Sampling Raw Dataset}
subset_db <- raw_database %>%
  sample_n(10000)

subset_db <- subset(subset_db, MUNICIPIO_RES != "999")

# subset(subset_db, MUNICIPIO_RES != "997", "998", "999)
# subset(subset_db, ENTIDAD_RES != "36", "97", "98", "99")
```

##### 1c. Uncoding Municipalities
The code book provided by the Mexican Directory of Epidemiology for the raw database(201128 Catalogos.xlsx) was imported. The names and class of variables regarding state and municipality residency were then modified in such a way that they'd match with thier corresponding variables in the dataset **subset_db**. A new object was created with this data and named **municipality_names**.
```{r warning=FALSE}
municipality_names <- read_excel("~/Documents/Investigación/Projects/vulnerability_index_covid/01_analysis/diccionario_datos_covid19/201128 Catalogos.xlsx",
  sheet = "Catálogo MUNICIPIOS",
  col_types = c(
    "numeric",
    "text",
    "numeric"
  )
) %>%
  rename(MUNICIPIO_RES = CLAVE_MUNICIPIO) %>%
  rename(ENTIDAD_RES = CLAVE_ENTIDAD)
```
**municipality_names** was then filtered. Observations where municipalities were unspecific were removed.

*codes were not piped together to avoid, error of coertion because of class differences*
```{r}
municipality_names <- subset(municipality_names, MUNICIPIO != "NO ESPECIFICADO")
municipality_names <- subset(municipality_names, MUNICIPIO != "SE IGNORA")
municipality_names <- subset(municipality_names, MUNICIPIO != "NO APLICA")
```
The **full_join** function was then used to merge both datasets creating a new object called **joined_db**. Incomplete cases were removed.
```{r}
joined_db <- subset_db %>%
  full_join(municipality_names, by = c(
    "ENTIDAD_RES" = "ENTIDAD_RES",
    "MUNICIPIO_RES" = "MUNICIPIO_RES"
  )) %>%
  na.omit(.)
```
PD: Incomplete cases were all municipalities that did not report any case.
```{r}
# joined_db[!complete.cases(joined_db), ]
```

##### 1d. Uncoding States
The names ofeach state in **joined_db** was uncoded, changing them from a numeric code to their actual names.
```{r}
joined_db <- joined_db %>%
  mutate(
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 1, "Aguascalientes"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 2, "Baja California"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 3, "Baja California Sur"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 4, "Campeche"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 5, "Coahuila de Zaragoza"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 6, "Colima"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 7, "Chiapas"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 8, "Chihuahua"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 9, "Distrito Federal"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 10, "Durango"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 11, "Guanajuato"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 12, "Guerrero"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 13, "Hidalgo"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 14, "Jalisco"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 15, "México"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 16, "Michoacán de Ocampo"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 17, "Morelos"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 18, "Nayarit"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 19, "Nuevo León"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 20, "Oaxaca"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 21, "Puebla"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 22, "Querétaro"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 23, "Quintana Roo"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 24, "San Luis Potosí"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 25, "Sinaloa"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 26, "Sonora"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 27, "Tabasco"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 28, "Tamaulipas"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 29, "Tlaxcala"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 30, "Veracruz de Ignacio de la Llave"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 31, "Yucatán"),
    ENTIDAD_RES = replace(ENTIDAD_RES, ENTIDAD_RES == 32, "Zacatecas")
  )
```
### 2. Adding Vulnerability Index Variables to Database
##### 2a. Loading Database and Variable Modification
The database provided by UNAM and INEGI showing the vulnerability index for each municipality was imported. Unnecessary columns were excluded. Name and class of the variables regarding state and municipality residency were modified in such a way they would match with their corresponding variables in the *joined_db* dataset. This data was assign to a new object called **covid_vi**.
```{r}
library(readr)
covid_vi <- read_csv("~/Documents/Investigación/Projects/vulnerability_index_covid/01_analysis/unam_vi/baseindiceygradodevulnerabilidad_covid19_2020 (1).csv",
  col_types = cols(
    FID = col_skip(), `Sin alias (gid)` = col_skip(),
    `Clave única de municipio (cveu_mun)` = col_skip(),
    `Clave de la entidad (cve_ent)` = col_skip(),
    the_geom = col_skip()
  )
) %>%
  rename(MUNICIPIO = "Nombre del municipio (nom_mun)") %>%
  rename(ENTIDAD_RES = "Nombre de entidad (nom_ent)") %>%
  rename(INDICE_DE_VULNERABILIDAD = "Índice de vulnerabilidad a covid-19 (indice_uno)") %>%
  rename(GRADO_DE_VULNERABILIDAD = "Grado de vulnerabilidad a covid-19 (vulnerabil)")
covid_vi$GRADO_DE_VULNERABILIDAD <- factor(covid_vi$GRADO_DE_VULNERABILIDAD, levels = c("Media", "Alta", "Muy alta", "Cr¡tica"))
```
All observations in **covid_vi** were relevant and complete. 
```{r}
# covid_vi[!complete.cases(covid_vi), ]
```
##### 2b. Making Variables Homogenous

Output in datasets **joined_db** and **covid_vi** were made to be capitalization compatible in preparation for use of the *full_join* function.
```{r}
covid_vi$MUNICIPIO <- toupper(covid_vi$MUNICIPIO)
```
##### 2c. Adding Vunerability Index Variable
The *full_join* function was used to join both datasets. A new object with this data was created called **full_db**. Incomplete cases were omited
```{r}
full_db <- joined_db %>%
  full_join(covid_vi, by = c(
    "ENTIDAD_RES" = "ENTIDAD_RES",
    "MUNICIPIO" = "MUNICIPIO"
  )) %>%
  na.omit(.)
```
PD: Incomplete cases consisted of  municipalities that did not report any COVID case or municipalities(minimal) with out a vulnerability index assigned to it. 
```{r}
# full_db[!complete.cases(full_db), ]
```
### 3. Uncoding Database
Part of Emerald's code was extracted and used to uncode data.
```{r echo=TRUE}
uncoded_db <- full_db %>%
  mutate(
    ORIGEN = replace(ORIGEN, ORIGEN == 1, "USMER"),
    ORIGEN = replace(ORIGEN, ORIGEN == 2, "NO USMER"),
    SECTOR = replace(SECTOR, SECTOR == 1, "CRUZ ROJA"),
    SECTOR = replace(SECTOR, SECTOR == 2, "DIF"),
    SECTOR = replace(SECTOR, SECTOR == 3, "ESTATAL"),
    SECTOR = replace(SECTOR, SECTOR == 4, "IMSS"),
    SECTOR = replace(SECTOR, SECTOR == 5, "IMSS-BIENESTAR"),
    SECTOR = replace(SECTOR, SECTOR == 6, "ISSSTE"),
    SECTOR = replace(SECTOR, SECTOR == 7, "MUNICIPAL"),
    SECTOR = replace(SECTOR, SECTOR == 8, "PEMEX"),
    SECTOR = replace(SECTOR, SECTOR == 9, "PRIVADA"),
    SECTOR = replace(SECTOR, SECTOR == 10, "SEDENA"),
    SECTOR = replace(SECTOR, SECTOR == 11, "SEMAR"),
    SECTOR = replace(SECTOR, SECTOR == 12, "SSA"),
    SECTOR = replace(SECTOR, SECTOR == 13, "UNIVERSITARIO"),
    SECTOR = replace(SECTOR, SECTOR == 99, "NO ESPECIFICADO"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 1, "AGUASCALIENTES"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 2, "BAJA CALIFORNIA"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 3, "BAJA CALIFORNIA SUR"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 4, "CAMPECHE"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 5, "COAHUILA"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 6, "COLIMA"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 7, "CHIAPAS"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 8, "CHIHUAHUA"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 9, "CIUDAD DE MÉXICO"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 10, "DURANGO"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 11, "GUANAJUATO"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 12, "GUERRERO"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 13, "HIDALGO"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 14, "JALISCO"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 15, "MÉXICO"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 16, "MICHOACÁN"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 17, "MORELOS"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 18, "NAYARIT"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 19, "NUEVO LEÓN"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 20, "OAXACA"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 21, "PUEBLA"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 22, "QUERÉTARO"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 23, "QUINTANO ROO"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 24, "SAN LUIS POTOSÍ"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 25, "SINALOA"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 26, "SONORA"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 27, "TABASCO"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 28, "TAMAULIPAS"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 29, "TLAXCALA"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 30, "VERACRUZ"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 31, "YUCATÁN"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 32, "ZACATECAS"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 36, "ESTADOS UNIDOS MEXICANOS"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 97, "NO APLICA"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 98, "SE IGNORA"),
    ENTIDAD_UM = replace(ENTIDAD_UM, ENTIDAD_UM == 99, "NO ESPECIFICADO"),
    SEXO = replace(SEXO, SEXO == 1, "MUJER"),
    SEXO = replace(SEXO, SEXO == 2, "HOMBRE"),
    SEXO = replace(SEXO, SEXO == 99, "NO ESPECIFICADO"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 1, "AGUASCALIENTES"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 2, "BAJA CALIFORNIA"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 3, "BAJA CALIFORNIA SUR"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 4, "CAMPECHE"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 5, "COAHUILA"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 6, "COLIMA"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 7, "CHIAPAS"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 8, "CHIHUAHUA"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 9, "CIUDAD DE MÉXICO"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 10, "DURANGO"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 11, "GUANAJUATO"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 12, "GUERRERO"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 13, "HIDALGO"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 14, "JALISCO"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 15, "MÉXICO"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 16, "MICHOACÁN"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 17, "MORELOS"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 18, "NAYARIT"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 19, "NUEVO LEÓN"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 20, "OAXACA"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 21, "PUEBLA"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 22, "QUERÉTARO"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 23, "QUINTANO ROO"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 24, "SAN LUIS POTOSÍ"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 25, "SINALOA"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 26, "SONORA"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 27, "TABASCO"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 28, "TAMAULIPAS"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 29, "TLAXCALA"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 30, "VERACRUZ"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 31, "YUCATÁN"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 32, "ZACATECAS"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 36, "ESTADOS UNIDOS MEXICANOS"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 97, "NO APLICA"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 98, "SE IGNORA"),
    ENTIDAD_NAC = replace(ENTIDAD_NAC, ENTIDAD_NAC == 99, "NO ESPECIFICADO"),
    TIPO_PACIENTE = replace(TIPO_PACIENTE, TIPO_PACIENTE == 1, "AMBULATORIO"),
    TIPO_PACIENTE = replace(TIPO_PACIENTE, TIPO_PACIENTE == 2, "HOSPITALIZADO"),
    TIPO_PACIENTE = replace(TIPO_PACIENTE, TIPO_PACIENTE == 99, "NO ESPECIFICADO"),
    INTUBADO = replace(INTUBADO, INTUBADO == 1, "SI"),
    INTUBADO = replace(INTUBADO, INTUBADO == 2, "NO"),
    INTUBADO = replace(INTUBADO, INTUBADO == 97, "NO APLICA"),
    INTUBADO = replace(INTUBADO, INTUBADO == 98, "SE IGNORA"),
    INTUBADO = replace(INTUBADO, INTUBADO == 99, "NO ESPECIFICADO"),
    NEUMONIA = replace(NEUMONIA, NEUMONIA == 1, "SI"),
    NEUMONIA = replace(NEUMONIA, NEUMONIA == 2, "NO"),
    NEUMONIA = replace(NEUMONIA, NEUMONIA == 97, "NO APLICA"),
    NEUMONIA = replace(NEUMONIA, NEUMONIA == 98, "SE IGNORA"),
    NEUMONIA = replace(NEUMONIA, NEUMONIA == 99, "NO ESPECIFICADO"),
    NACIONALIDAD = replace(NACIONALIDAD, NACIONALIDAD == 1, "MEXICANA"),
    NACIONALIDAD = replace(NACIONALIDAD, NACIONALIDAD == 2, "EXTRANJERA"),
    NACIONALIDAD = replace(NACIONALIDAD, NACIONALIDAD == 99, "NO ESPECIFICADO"),
    EMBARAZO = replace(EMBARAZO, EMBARAZO == 1, "SI"),
    EMBARAZO = replace(EMBARAZO, EMBARAZO == 2, "NO"),
    EMBARAZO = replace(EMBARAZO, EMBARAZO == 97, "NO APLICA"),
    EMBARAZO = replace(EMBARAZO, EMBARAZO == 98, "SE IGNORA"),
    EMBARAZO = replace(EMBARAZO, EMBARAZO == 99, "NO ESPECIFICADO"),
    HABLA_LENGUA_INDIG = replace(HABLA_LENGUA_INDIG, HABLA_LENGUA_INDIG == 1, "SI"),
    HABLA_LENGUA_INDIG = replace(HABLA_LENGUA_INDIG, HABLA_LENGUA_INDIG == 2, "NO"),
    HABLA_LENGUA_INDIG = replace(HABLA_LENGUA_INDIG, HABLA_LENGUA_INDIG == 97, "NO APLICA"),
    HABLA_LENGUA_INDIG = replace(HABLA_LENGUA_INDIG, HABLA_LENGUA_INDIG == 98, "SE IGNORA"),
    HABLA_LENGUA_INDIG = replace(HABLA_LENGUA_INDIG, HABLA_LENGUA_INDIG == 99, "NO ESPECIFICADO"),
    INDIGENA = replace(INDIGENA, INDIGENA == 1, "SI"),
    INDIGENA = replace(INDIGENA, INDIGENA == 2, "NO"),
    INDIGENA = replace(INDIGENA, INDIGENA == 97, "NO APLICA"),
    INDIGENA = replace(INDIGENA, INDIGENA == 98, "SE IGNORA"),
    INDIGENA = replace(INDIGENA, INDIGENA == 99, "NO ESPECIFICADO"),
    DIABETES = replace(DIABETES, DIABETES == 1, "SI"),
    DIABETES = replace(DIABETES, DIABETES == 2, "NO"),
    DIABETES = replace(DIABETES, DIABETES == 97, "NO APLICA"),
    DIABETES = replace(DIABETES, DIABETES == 98, "SE IGNORA"),
    DIABETES = replace(DIABETES, DIABETES == 99, "NO ESPECIFICADO"),
    EPOC = replace(EPOC, EPOC == 1, "SI"),
    EPOC = replace(EPOC, EPOC == 2, "NO"),
    EPOC = replace(EPOC, EPOC == 97, "NO APLICA"),
    EPOC = replace(EPOC, EPOC == 98, "SE IGNORA"),
    EPOC = replace(EPOC, EPOC == 99, "NO ESPECIFICADO"),
    ASMA = replace(ASMA, ASMA == 1, "SI"),
    ASMA = replace(ASMA, ASMA == 2, "NO"),
    ASMA = replace(ASMA, ASMA == 97, "NO APLICA"),
    ASMA = replace(ASMA, ASMA == 98, "SE IGNORA"),
    ASMA = replace(ASMA, ASMA == 99, "NO ESPECIFICADO"),
    INMUSUPR = replace(INMUSUPR, INMUSUPR == 1, "SI"),
    INMUSUPR = replace(INMUSUPR, INMUSUPR == 2, "NO"),
    INMUSUPR = replace(INMUSUPR, INMUSUPR == 97, "NO APLICA"),
    INMUSUPR = replace(INMUSUPR, INMUSUPR == 98, "SE IGNORA"),
    INMUSUPR = replace(INMUSUPR, INMUSUPR == 99, "NO ESPECIFICADO"),
    HIPERTENSION = replace(HIPERTENSION, HIPERTENSION == 1, "SI"),
    HIPERTENSION = replace(HIPERTENSION, HIPERTENSION == 2, "NO"),
    HIPERTENSION = replace(HIPERTENSION, HIPERTENSION == 97, "NO APLICA"),
    HIPERTENSION = replace(HIPERTENSION, HIPERTENSION == 98, "SE IGNORA"),
    HIPERTENSION = replace(HIPERTENSION, HIPERTENSION == 99, "NO ESPECIFICADO"),
    OTRA_COM = replace(OTRA_COM, OTRA_COM == 1, "SI"),
    OTRA_COM = replace(OTRA_COM, OTRA_COM == 2, "NO"),
    OTRA_COM = replace(OTRA_COM, OTRA_COM == 97, "NO APLICA"),
    OTRA_COM = replace(OTRA_COM, OTRA_COM == 98, "SE IGNORA"),
    OTRA_COM = replace(OTRA_COM, OTRA_COM == 99, "NO ESPECIFICADO"),
    CARDIOVASCULAR = replace(CARDIOVASCULAR, CARDIOVASCULAR == 1, "SI"),
    CARDIOVASCULAR = replace(CARDIOVASCULAR, CARDIOVASCULAR == 2, "NO"),
    CARDIOVASCULAR = replace(CARDIOVASCULAR, CARDIOVASCULAR == 97, "NO APLICA"),
    CARDIOVASCULAR = replace(CARDIOVASCULAR, CARDIOVASCULAR == 98, "SE IGNORA"),
    CARDIOVASCULAR = replace(CARDIOVASCULAR, CARDIOVASCULAR == 99, "NO ESPECIFICADO"),
    CARDIOVASCULAR = replace(CARDIOVASCULAR, CARDIOVASCULAR == 1, "SI"),
    CARDIOVASCULAR = replace(CARDIOVASCULAR, CARDIOVASCULAR == 2, "NO"),
    CARDIOVASCULAR = replace(CARDIOVASCULAR, CARDIOVASCULAR == 97, "NO APLICA"),
    CARDIOVASCULAR = replace(CARDIOVASCULAR, CARDIOVASCULAR == 98, "SE IGNORA"),
    CARDIOVASCULAR = replace(CARDIOVASCULAR, CARDIOVASCULAR == 99, "NO ESPECIFICADO"),
    OBESIDAD = replace(OBESIDAD, OBESIDAD == 1, "SI"),
    OBESIDAD = replace(OBESIDAD, OBESIDAD == 2, "NO"),
    OBESIDAD = replace(OBESIDAD, OBESIDAD == 97, "NO APLICA"),
    OBESIDAD = replace(OBESIDAD, OBESIDAD == 98, "SE IGNORA"),
    OBESIDAD = replace(OBESIDAD, OBESIDAD == 99, "NO ESPECIFICADO"),
    RENAL_CRONICA = replace(RENAL_CRONICA, RENAL_CRONICA == 1, "SI"),
    RENAL_CRONICA = replace(RENAL_CRONICA, RENAL_CRONICA == 2, "NO"),
    RENAL_CRONICA = replace(RENAL_CRONICA, RENAL_CRONICA == 97, "NO APLICA"),
    RENAL_CRONICA = replace(RENAL_CRONICA, RENAL_CRONICA == 98, "SE IGNORA"),
    RENAL_CRONICA = replace(RENAL_CRONICA, RENAL_CRONICA == 99, "NO ESPECIFICADO"),
    TABAQUISMO = replace(TABAQUISMO, TABAQUISMO == 1, "SI"),
    TABAQUISMO = replace(TABAQUISMO, TABAQUISMO == 2, "NO"),
    TABAQUISMO = replace(TABAQUISMO, TABAQUISMO == 97, "NO APLICA"),
    TABAQUISMO = replace(TABAQUISMO, TABAQUISMO == 98, "SE IGNORA"),
    TABAQUISMO = replace(TABAQUISMO, TABAQUISMO == 99, "NO ESPECIFICADO"),
    OTRO_CASO = replace(OTRO_CASO, OTRO_CASO == 1, "SI"),
    OTRO_CASO = replace(OTRO_CASO, OTRO_CASO == 2, "NO"),
    OTRO_CASO = replace(OTRO_CASO, OTRO_CASO == 97, "NO APLICA"),
    OTRO_CASO = replace(OTRO_CASO, OTRO_CASO == 98, "SE IGNORA"),
    OTRO_CASO = replace(OTRO_CASO, OTRO_CASO == 99, "NO ESPECIFICADO"),
    TOMA_MUESTRA_LAB = replace(TOMA_MUESTRA_LAB, TOMA_MUESTRA_LAB == 1, "SI"),
    TOMA_MUESTRA_LAB = replace(TOMA_MUESTRA_LAB, TOMA_MUESTRA_LAB == 2, "NO"),
    TOMA_MUESTRA_LAB = replace(TOMA_MUESTRA_LAB, TOMA_MUESTRA_LAB == 97, "NO APLICA"),
    TOMA_MUESTRA_LAB = replace(TOMA_MUESTRA_LAB, TOMA_MUESTRA_LAB == 98, "SE IGNORA"),
    TOMA_MUESTRA_LAB = replace(TOMA_MUESTRA_LAB, TOMA_MUESTRA_LAB == 99, "NO ESPECIFICADO"),
    RESULTADO_LAB = replace(RESULTADO_LAB, RESULTADO_LAB == 1, "POSITIVO A SARS-COV-2"),
    RESULTADO_LAB = replace(RESULTADO_LAB, RESULTADO_LAB == 2, "NO POSITIVO A SARS-COV-2"),
    RESULTADO_LAB = replace(RESULTADO_LAB, RESULTADO_LAB == 3, "RESULTADO PENDIENTE"),
    RESULTADO_LAB = replace(RESULTADO_LAB, RESULTADO_LAB == 4, "RESULTADO NO ADECUADO"),
    RESULTADO_LAB = replace(RESULTADO_LAB, RESULTADO_LAB == 97, "NO APLICA"),
    TOMA_MUESTRA_ANTIGENO = replace(TOMA_MUESTRA_ANTIGENO, TOMA_MUESTRA_ANTIGENO == 1, "SI"),
    TOMA_MUESTRA_ANTIGENO = replace(TOMA_MUESTRA_ANTIGENO, TOMA_MUESTRA_ANTIGENO == 2, "NO"),
    TOMA_MUESTRA_ANTIGENO = replace(TOMA_MUESTRA_ANTIGENO, TOMA_MUESTRA_ANTIGENO == 97, "NO APLICA"),
    TOMA_MUESTRA_ANTIGENO = replace(TOMA_MUESTRA_ANTIGENO, TOMA_MUESTRA_ANTIGENO == 98, "SE IGNORA"),
    TOMA_MUESTRA_ANTIGENO = replace(TOMA_MUESTRA_ANTIGENO, TOMA_MUESTRA_ANTIGENO == 99, "NO ESPECIFICADO"),
    RESULTADO_ANTIGENO = replace(RESULTADO_ANTIGENO, RESULTADO_ANTIGENO == 1, "POSITIVO  A SARS-COV-2"),
    RESULTADO_ANTIGENO = replace(RESULTADO_ANTIGENO, RESULTADO_ANTIGENO == 2, "NEGATIVO  A SARS-COV-2"),
    RESULTADO_ANTIGENO = replace(RESULTADO_ANTIGENO, RESULTADO_ANTIGENO == 97, "NO APLICA"),
    CLASIFICACION_FINAL = replace(CLASIFICACION_FINAL, CLASIFICACION_FINAL == 1, "CONFIRMADO POR EPIDEMIOLOGÍA"),
    CLASIFICACION_FINAL = replace(CLASIFICACION_FINAL, CLASIFICACION_FINAL == 2, "CONFIRMADO POR COMITÉ"),
    CLASIFICACION_FINAL = replace(CLASIFICACION_FINAL, CLASIFICACION_FINAL == 3, "CONFIRMADO"),
    CLASIFICACION_FINAL = replace(CLASIFICACION_FINAL, CLASIFICACION_FINAL == 4, "INVALIDO"),
    CLASIFICACION_FINAL = replace(CLASIFICACION_FINAL, CLASIFICACION_FINAL == 5, "NO REALIZADO"),
    CLASIFICACION_FINAL = replace(CLASIFICACION_FINAL, CLASIFICACION_FINAL == 6, "SOSPECHOSO"),
    CLASIFICACION_FINAL = replace(CLASIFICACION_FINAL, CLASIFICACION_FINAL == 7, "NEGATIVO"),
    MIGRANTE = replace(MIGRANTE, MIGRANTE == 99, "NO ESPECIFICADO"),
    PAIS_NACIONALIDAD = replace(PAIS_NACIONALIDAD, PAIS_NACIONALIDAD == "México", "MEXICANA"),
    PAIS_ORIGEN = replace(PAIS_ORIGEN, PAIS_ORIGEN == 97, "NO APLICA"),
    UCI = replace(UCI, UCI == 1, "SI"),
    UCI = replace(UCI, UCI == 2, "NO"),
    UCI = replace(UCI, UCI == 97, "NO APLICA"),
    UCI = replace(UCI, UCI == 99, "NO ESPECIFICADO"),
    FECHA_DEF = replace(FECHA_DEF,FECHA_DEF == 9999-99-99,"VIVO"),
    FECHA_DEF = replace(FECHA_DEF,FECHA_DEF != 9999-99-99,"FALLECIDO"))
```
Here's a peak at the **uncoded_db** dataset:
```{r}
glimpse(uncoded_db)
```
### 4. Creating a Cohort
The following cohort was created: 

"Nonsmoking mexican patients, not diagnosed with pregnancy, COPD, asthma, inmmunosupression, CVD, HTAS, Obesity, CRD or other chronic diseases with diagnosis of pnuemonia due to COVID-19 and didn't recieve ICU or endotraqueal intubation irrespective of DM2."

##### 4a. Selection of Relevant Variables
Variables class were changed to factor. Relevant colums were selected and a new object was created called **clean_db**.
```{r}
uncoded_db$GRADO_DE_VULNERABILIDAD <- as.factor(uncoded_db$GRADO_DE_VULNERABILIDAD)

uncoded_db$TIPO_PACIENTE <- as.factor(uncoded_db$TIPO_PACIENTE)

clean_db <- uncoded_db %>% select(ID_REGISTRO, EDAD, SEXO, EMBARAZO, INDIGENA, HABLA_LENGUA_INDIG, ENTIDAD_RES, MUNICIPIO, NACIONALIDAD, TABAQUISMO, OBESIDAD, DIABETES, HIPERTENSION, EPOC, ASMA, INMUSUPR, CARDIOVASCULAR, RENAL_CRONICA, OTRA_COM, CLASIFICACION_FINAL, SECTOR, TIPO_PACIENTE, NEUMONIA, INTUBADO, UCI, INDICE_DE_VULNERABILIDAD, GRADO_DE_VULNERABILIDAD, FECHA_DEF)
```
##### 4b. Filtering Variables
**clean_db** was filtered to create the cohort previously described. An object with this data was created and called **cohort**
```{r}
cohort <- clean_db %>%
  filter(!EMBARAZO == "SI") %>%
  filter(NACIONALIDAD == "MEXICANA") %>%
  filter(TABAQUISMO == "NO") %>%
  filter(!DIABETES == "SE IGNORA") %>%
  filter(!HIPERTENSION == "SI") %>%
  filter(!OBESIDAD == "SI") %>%
  filter(EPOC == "NO") %>%
  filter(ASMA == "NO") %>%
  filter(INMUSUPR == "NO") %>%
  filter(CARDIOVASCULAR == "NO") %>%
  filter(RENAL_CRONICA == "NO") %>%
  filter(OTRA_COM == "NO") %>%
  filter(!CLASIFICACION_FINAL == "NEGATIVO") %>%
  filter(!CLASIFICACION_FINAL == "NO REALIZADO") %>%
  filter(!CLASIFICACION_FINAL == "SOSPECHOSO") %>%
  filter(!CLASIFICACION_FINAL == "INVALIDO") %>%
  filter(NEUMONIA == "SI") %>%
  filter(INTUBADO == "NO") %>%
  filter(UCI == "NO")
```
The object **cohort** was then filtered to show only variables that differ in the cohort. 
An object with this data was created and called **clean_cohort**.
**clean_cohort** was then filtered and 4 cohorts were created based on the variable "GRADO_DE_VULNERABILIDAD".
```{r}
clean_cohort <- cohort %>%
  select(EDAD, SEXO, INDIGENA, DIABETES, ENTIDAD_RES, MUNICIPIO, SECTOR, TIPO_PACIENTE, GRADO_DE_VULNERABILIDAD,  INDICE_DE_VULNERABILIDAD,FECHA_DEF)
```
### 5. Descriptive Analysis
##### 5a1. Table 1 of Clean Cohort - All patients
```{r}
# install.packages("gtsummary")
library(gtsummary)

table1_clean_cohort <- clean_cohort %>%
  select(EDAD, INDICE_DE_VULNERABILIDAD, SEXO, INDIGENA, DIABETES, SECTOR, TIPO_PACIENTE, GRADO_DE_VULNERABILIDAD, FECHA_DEF)

table1_clean_cohort %>%
  tbl_summary(
    by = GRADO_DE_VULNERABILIDAD, label = list(INDICE_DE_VULNERABILIDAD ~ "INDICE DE VULNERABILIDAD", SECTOR ~ "INSTITUCIÓN", TIPO_PACIENTE ~ "ANTENCIÓN", FECHA_DEF ~ "DESENLACE")) %>%
  add_overall() %>%
  add_p() %>%
  bold_labels() %>%
  italicize_levels() %>%
  modify_header(
    update = list(
      label ~ "**Grado de Vulnerabilidad**",
      stat_4 ~ "**Critica**, N = 1"))
```
##### Creating datasets by Grado de Vulnerabilidad
```{r}
clean_cohort_media <- clean_cohort %>%
  filter(GRADO_DE_VULNERABILIDAD == "Media")

clean_cohort_alta <- clean_cohort %>%
  filter(GRADO_DE_VULNERABILIDAD == "Alta")

clean_cohort_muy_alta <- clean_cohort %>%
  filter(GRADO_DE_VULNERABILIDAD == "Muy alta")

clean_cohort_critica <- clean_cohort %>%
  filter(GRADO_DE_VULNERABILIDAD == "Cr¡tica")
```


##### 5a2. Table 1 of Clean Cohort Media - Only patients with Grado de Vulnerabilidad *Media*
```{r}
table1_media_clean_cohort <- clean_cohort_media %>%
  select(EDAD, INDICE_DE_VULNERABILIDAD, SEXO, INDIGENA, DIABETES, SECTOR, TIPO_PACIENTE, FECHA_DEF)

table1_media_clean_cohort %>%
  tbl_summary(by = SEXO, label = list(INDICE_DE_VULNERABILIDAD ~ "INDICE DE VULNERABILIDAD", SECTOR ~ "INSTITUCIÓN", TIPO_PACIENTE ~ "ANTENCIÓN", FECHA_DEF ~ "DESENLACE")) %>%
  add_overall() %>% 
  add_p() %>% 
  bold_labels() %>% 
  italicize_levels() %>%
  modify_header(
    update = list(
      label ~ "**SEXO**"))
```

##### 5a3. Table 1 of Clean Cohort Alta - Only patients with Grado de Vulnerabilidad *Alta*
```{r}
table1_alta_clean_cohort <- clean_cohort_alta %>%
  select(EDAD, INDICE_DE_VULNERABILIDAD, SEXO, INDIGENA, DIABETES, SECTOR, TIPO_PACIENTE, FECHA_DEF)

table1_alta_clean_cohort %>%
  tbl_summary(by = SEXO, label = list(INDICE_DE_VULNERABILIDAD ~ "INDICE DE VULNERABILIDAD", SECTOR ~ "INSTITUCIÓN", TIPO_PACIENTE ~ "ANTENCIÓN", FECHA_DEF ~ "DESENLACE")) %>%
  add_overall() %>% 
  add_p() %>% 
  bold_labels() %>% 
  italicize_levels() %>%
  modify_header(
    update = list(
      label ~ "**SEXO**"))
```
##### 5a4. Table 1 of Clean Cohort Muy Alta - Only patients with Grado de Vulnerabilidad *Muy Alta*
```{r}
table1_muy_alta_clean_cohort <- clean_cohort_muy_alta %>%
  select(EDAD, INDICE_DE_VULNERABILIDAD, SEXO, INDIGENA, DIABETES, SECTOR, TIPO_PACIENTE, FECHA_DEF)

table1_muy_alta_clean_cohort %>%
  tbl_summary(by = SEXO, label = list(INDICE_DE_VULNERABILIDAD ~ "INDICE DE VULNERABILIDAD", SECTOR ~ "INSTITUCIÓN", TIPO_PACIENTE ~ "ANTENCIÓN", FECHA_DEF ~ "DESENLACE")) %>%
  add_overall() %>% 
  add_p() %>% 
  bold_labels() %>% 
  italicize_levels() %>%
  modify_header(
    update = list(
      label ~ "**SEXO**"))
```
##### 5a5. Table 1 of Clean Cohort Critica - Only patients with Grado de Vulnerabilidad *Critica*
```{r}
table1_critica_clean_cohort <- clean_cohort_critica %>%
  select(EDAD, INDICE_DE_VULNERABILIDAD, SEXO, INDIGENA, DIABETES, SECTOR, TIPO_PACIENTE, FECHA_DEF)

table1_critica_clean_cohort %>%
  tbl_summary(by = SEXO, label = list(INDICE_DE_VULNERABILIDAD ~ "INDICE DE VULNERABILIDAD", SECTOR ~ "INSTITUCIÓN", TIPO_PACIENTE ~ "ANTENCIÓN", FECHA_DEF ~ "DESENLACE")) %>%
  add_overall() %>% 
  add_p() %>% 
  bold_labels() %>% 
  italicize_levels() %>%
  modify_header(
    update = list(
      label ~ "**SEXO**"))
```


##### 5b.Graphic Representation of Data
Creating categorical Variable for Age
```{r}
clean_cohort$EDAD_CATEG <- clean_cohort$EDAD

clean_cohort$EDAD_CATEG<-cut(clean_cohort$EDAD_CATEG, 
                             c(0,10,20,30,40,50,60,70,80,90,100,110),
                             labels = c("0-10", "11-20", "21-30", "31-40",
                                        "41-50", "51-60", "61-70", "71-80",
                                        "81-90", "91-100","100+"))
```
Demographic pyramid for all patients
```{r}
#pacman::p_load(apyramid)
require(apyramid)
apyramid::age_pyramid(data = clean_cohort,
                      age_group = "EDAD_CATEG",
                      split_by = "SEXO",
                      proportional = TRUE)
```
5b. Barchart showing States and Health Institution of patients in *Clean_Cohort*
```{r}
ggplot(clean_cohort) +
  aes(x = ENTIDAD_RES, fill = SECTOR) +
  geom_bar() +
  scale_fill_hue(direction = -1) +
  labs(
    x = "State of Residence",
    y = "Count",
    title = "State of orgin and respective health Institution",
    caption = "Count",
    fill = "Institution"
  ) +
  coord_flip() +
  theme_light()
```
Jitter Plot showing Vulneraability index, Age and Outcome  in *Clean_Cohort*
```{r}
ggplot(clean_cohort) +
  aes(
    x = EDAD,
    y = INDICE_DE_VULNERABILIDAD,
    colour = FECHA_DEF
  ) +
  geom_jitter(size = 1.5) +
  scale_color_brewer(palette = "Paired", direction = -1) +
  labs(
    x = "Age",
    y = "Vulnerability Index",
    title = "JitterPlot showing Age,
             Vulnerability Index,
             and outcome",
    color = "Outcome"
  ) +
  coord_flip() +
  theme_light()
```
5b. BoxPlot showing Vulneraability index, History of DM2 and Outcome  in *Clean_Cohort*
```{r}
ggplot(clean_cohort) +
  aes(
    x = DIABETES,
    y = INDICE_DE_VULNERABILIDAD,
    colour = FECHA_DEF
  ) +
  geom_boxplot(fill = "#112446") +
  scale_color_brewer(palette = "Paired", direction = -1) +
  labs(
    x = "Diabetes",
    y = "Vulnerability Index",
    title = "Boxplot showing Vulnerability Index,
             History of DM2 and outcome",
    color = "Outcome"
  ) +
  coord_flip() +
  theme_light()
```
##### 5b. Patients with "Media" Vulnerability Graphical Representation of Data
###### clean_cohort_media
Demographic Pyramid
```{r}
clean_cohort_media$EDAD_CATEG <- clean_cohort_media$EDAD

clean_cohort_media$EDAD_CATEG<-cut(clean_cohort_media$EDAD_CATEG, 
                             c(0,10,20,30,40,50,60,70,80,90,100,110),
                             labels = c("0-10", "11-20", "21-30", "31-40",
                                        "41-50", "51-60", "61-70", "71-80",
                                        "81-90", "91-100","100+"))
```
```{r}
require(apyramid)

apyramid::age_pyramid(data = clean_cohort_media,
                      age_group = "EDAD_CATEG",
                      split_by = "SEXO",
                      proportional = TRUE)
```
5b. Barchart showing States and Health Institution of patients in *clean_cohort_media*
```{r}
ggplot(clean_cohort_media) +
  aes(x = ENTIDAD_RES, fill = SECTOR) +
  geom_bar() +
  scale_fill_hue(direction = -1) +
  labs(
    x = "State of Residence",
    y = "Count",
    title = "State of orgin and respective health Institution",
    caption = "Count",
    fill = "Institution") +
  coord_flip() +
  theme_light()
```
5b. Jitter Plot showing Vulneraability index, Age and Outcome  in *clean_cohort_media*
```{r}
#install.packages("esquisse")
#esquisse::esquisser()

ggplot(clean_cohort_media) +
  aes(
    x = EDAD,
    y = INDICE_DE_VULNERABILIDAD,
    colour = FECHA_DEF
  ) +
  geom_jitter(size = 1.5) +
  scale_color_brewer(palette = "Paired", direction = -1) +
  labs(
    x = "Age",
    y = "Vulnerability Index",
    title = "JitterPlot showing Age,
             Vulnerability Index,
             and outcome",
    color = "Outcome"
  ) +
  coord_flip() +
  theme_light()
```
5b. BoxPlot showing Vulnerability index, History of DM2 and Outcome  in *clean_cohort_media*
```{r}
ggplot(clean_cohort_media) +
  aes(
    x = DIABETES,
    y = INDICE_DE_VULNERABILIDAD,
    colour = FECHA_DEF
  ) +
  geom_boxplot(fill = "#112446") +
  scale_color_brewer(palette = "Paired", direction = -1) +
  labs(
    x = "Diabetes",
    y = "Vulnerability Index",
    title = "Boxplot showing Vulnerability Index,
             History of DM2 and outcome",
    color = "Outcome"
  ) +
  coord_flip() +
  theme_light()
```
##### 5b. Patients with "Alta" Vulnerability Graphical Representation of Data
###### clean_cohort_alta
Demographic Pyramid
```{r}
clean_cohort_alta$EDAD_CATEG <- clean_cohort_alta$EDAD

clean_cohort_alta$EDAD_CATEG<-cut(clean_cohort_alta$EDAD_CATEG, 
                                   c(0,10,20,30,40,50,60,70,80,90,100,110),
                                   labels = c("0-10", "11-20", "21-30", "31-40",
                                              "41-50", "51-60", "61-70", "71-80",
                                              "81-90", "91-100","100+"))
```
```{r}
#pacman::p_load(apyramid)
require(apyramid)

apyramid::age_pyramid(data = clean_cohort_alta,
                      age_group = "EDAD_CATEG",
                      split_by = "SEXO",
                      proportional = TRUE)
```
5b. Barchart showing States and Health Institution of patients in *clean_cohort_alta*
```{r}
ggplot(clean_cohort_alta) +
  aes(x = ENTIDAD_RES, fill = SECTOR) +
  geom_bar() +
  scale_fill_hue(direction = -1) +
  labs(
    x = "State of Residence",
    y = "Count",
    title = "State of orgin and respective health Institution",
    caption = "Count",
    fill = "Institution") +
  coord_flip() +
  theme_light()
```
5b. Jitter Plot showing Vulneraability index, Age and Outcome  in *clean_cohort_alta*
```{r}
#install.packages("esquisse")
#esquisse::esquisser()

ggplot(clean_cohort_alta) +
  aes(
    x = EDAD,
    y = INDICE_DE_VULNERABILIDAD,
    colour = FECHA_DEF
  ) +
  geom_jitter(size = 1.5) +
  scale_color_brewer(palette = "Paired", direction = -1) +
  labs(
    x = "Age",
    y = "Vulnerability Index",
    title = "JitterPlot showing Age,
             Vulnerability Index,
             and outcome",
    color = "Outcome") +
  coord_flip() +
  theme_light()
```
5b. BoxPlot showing Vulneraability index, History of DM2 and Outcome  in *clean_cohort_alta*
```{r}
ggplot(clean_cohort_alta) +
  aes(
    x = DIABETES,
    y = INDICE_DE_VULNERABILIDAD,
    colour = FECHA_DEF
  ) +
  geom_boxplot(fill = "#112446") +
  scale_color_brewer(palette = "Paired", direction = -1) +
  labs(
    x = "Diabetes",
    y = "Vulnerability Index",
    title = "Boxplot showing Vulnerability Index,
             History of DM2 and outcome",
    color = "Outcome"
  ) +
  coord_flip() +
  theme_light()
```
##### 5b. Patients with "Muy Alta" Vulnerability Graphical Representation of Data
###### clean_cohort_muy_alta
Demographic Pyramid
```{r}
clean_cohort_muy_alta$EDAD_CATEG <- clean_cohort_muy_alta$EDAD

clean_cohort_muy_alta$EDAD_CATEG<-cut(clean_cohort_muy_alta$EDAD_CATEG, 
                                  c(0,10,20,30,40,50,60,70,80,90,100,110),
                                  labels = c("0-10", "11-20", "21-30", "31-40",
                                             "41-50", "51-60", "61-70", "71-80",
                                             "81-90", "91-100","100+"))
```
```{r}
#pacman::p_load(apyramid)
require(apyramid)

apyramid::age_pyramid(data = clean_cohort_muy_alta,
                      age_group = "EDAD_CATEG",
                      split_by = "SEXO",
                      proportional = TRUE)
```
5b. Barchart showing States and Health Institution of patients in *clean_cohort_muy_alta*
```{r}
ggplot(clean_cohort_muy_alta) +
  aes(x = ENTIDAD_RES, fill = SECTOR) +
  geom_bar() +
  scale_fill_hue(direction = -1) +
  labs(
    x = "State of Residence",
    y = "Count",
    title = "State of orgin and respective health Institution",
    caption = "Count",
    fill = "Institution") +
  coord_flip() +
  theme_light()
```
5b. Jitter Plot showing Vulneraability index, Age and Outcome  in *clean_cohort_muy_alta*
```{r}
ggplot(clean_cohort_muy_alta) +
  aes(
    x = EDAD,
    y = INDICE_DE_VULNERABILIDAD,
    colour = FECHA_DEF
  ) +
  geom_jitter(size = 1.5) +
  scale_color_brewer(palette = "Paired", direction = -1) +
  labs(
    x = "Age",
    y = "Vulnerability Index",
    title = "JitterPlot showing Age,
             Vulnerability Index,
             and outcome",
    color = "Outcome") +
  coord_flip() +
  theme_light()
```
5b. BoxPlot showing Vulneraability index, History of DM2 and Outcome  in *clean_cohort_muy_alta*
```{r}
ggplot(clean_cohort_muy_alta) +
  aes(
    x = DIABETES,
    y = INDICE_DE_VULNERABILIDAD,
    colour = FECHA_DEF
  ) +
  geom_boxplot(fill = "#112446") +
  scale_color_brewer(palette = "Paired", direction = -1) +
  labs(
    x = "Diabetes",
    y = "Vulnerability Index",
    title = "Boxplot showing Vulnerability Index,
             History of DM2 and outcome",
    color = "Outcome"
  ) +
  coord_flip() +
  theme_light()
```
##### 5b. Patients with "Critica" Vulnerability Graphical Representation of Data
###### clean_cohort_critica
Demographic Pyramid
```{r}
clean_cohort_critica$EDAD_CATEG <- clean_cohort_critica$EDAD

clean_cohort_critica$EDAD_CATEG<-cut(clean_cohort_critica$EDAD_CATEG, 
                                      c(0,10,20,30,40,50,60,70,80,90,100,110),
                                      labels = c("0-10", "11-20", "21-30", "31-40",
                                                 "41-50", "51-60", "61-70", "71-80",
                                                 "81-90", "91-100","100+"))
```
```{r}
#pacman::p_load(apyramid)
require(apyramid)

apyramid::age_pyramid(data = clean_cohort_critica,
                      age_group = "EDAD_CATEG",
                      split_by = "SEXO",
                      proportional = TRUE)
```
5b. Barchart showing States and Health Institution of patients in *clean_cohort_critica*
```{r}
ggplot(clean_cohort_critica) +
  aes(x = ENTIDAD_RES, fill = SECTOR) +
  geom_bar() +
  scale_fill_hue(direction = -1) +
  labs(
    x = "State of Residence",
    y = "Count",
    title = "State of orgin and respective health Institution",
    caption = "Count",
    fill = "Institution") +
  coord_flip() +
  theme_light()
```
5b. Jitter Plot showing Vulneraability index, Age and Outcome  in *clean_cohort_critica*
```{r}
#install.packages("esquisse")
#esquisse::esquisser()

ggplot(clean_cohort_critica) +
  aes(
    x = EDAD,
    y = INDICE_DE_VULNERABILIDAD,
    colour = FECHA_DEF
  ) +
  geom_jitter(size = 1.5) +
  scale_color_brewer(palette = "Paired", direction = -1) +
  labs(
    x = "Age",
    y = "Vulnerability Index",
    title = "JitterPlot showing Age,
             Vulnerability Index,
             and outcome",
    color = "Outcome") +
  coord_flip() +
  theme_light()
```
5b. BoxPlot showing Vulneraability index, History of DM2 and Outcome  in *clean_cohort_critica*
```{r}
ggplot(clean_cohort_critica) +
  aes(
    x = DIABETES,
    y = INDICE_DE_VULNERABILIDAD,
    colour = FECHA_DEF
  ) +
  geom_boxplot(fill = "#112446") +
  scale_color_brewer(palette = "Paired", direction = -1) +
  labs(
    x = "Diabetes",
    y = "Vulnerability Index",
    title = "Boxplot showing Vulnerability Index,
             History of DM2 and outcome",
    color = "Outcome"
  ) +
  coord_flip() +
  theme_light()
```


### 6. Statistical Analysis
```{r}
#install.packages("psych")
require(psych)

clean_cohort_alta %>% 
  phi(DIABETES,FECHA_DEF)
```

